\doxysection{compressao.\+c}
\hypertarget{compressao_8c_source}{}\label{compressao_8c_source}\index{src/compressao.c@{src/compressao.c}}

\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00001}00001\ \textcolor{preprocessor}{\#include\ <stdio.h>}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00002}00002\ \textcolor{preprocessor}{\#include\ "{}lista.h"{}}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00003}00003\ \textcolor{preprocessor}{\#include\ "{}arvore.h"{}}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00004}00004\ \textcolor{preprocessor}{\#include\ "{}compressao.h"{}}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00005}00005\ \textcolor{preprocessor}{\#include\ <stdint.h>}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00006}00006\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00007}00007\ \textcolor{comment}{//\ tamanho\ do\ arquivo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00008}00008\ \textcolor{comment}{//\ vai\ usar\ para\ calcular\ antes\ e\ depois\ de\ compactar}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00009}00009\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00010}00010\ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}\ calcularTamanho(FILE\ *arquivo)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00011}00011\ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00012}00012\ \ \ \ \ \textcolor{comment}{//\ Armazena\ a\ posição\ atual\ do\ cursor\ no\ arquivo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00013}00013\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00014}00014\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}\ posicaoAtual\ =\ ftell(arquivo);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00016}00016\ \ \ \ \ \textcolor{comment}{//\ Move\ o\ ponteiro\ até\ o\ final\ do\ arquivo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00017}00017\ \ \ \ \ fseek(arquivo,\ 0,\ SEEK\_END);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00018}00018\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00019}00019\ \ \ \ \ \textcolor{comment}{//\ Captura\ a\ posição\ atual,\ que\ é\ o\ tamanho\ do\ arquivo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00020}00020\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{long}\ \textcolor{keywordtype}{int}\ tamanho\_do\_arquivo\ =\ ftell(arquivo);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00021}00021\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00022}00022\ \ \ \ \ \textcolor{comment}{//\ Retorna\ para\ a\ posição\ original\ do\ cursor\ no\ arquivo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00023}00023\ \ \ \ \ fseek(arquivo,\ posicaoAtual,\ SEEK\_SET)\ !=\ 0;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00024}00024\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00025}00025\ \ \ \ \ \textcolor{keywordflow}{return}\ tamanho\_do\_arquivo;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00026}00026\ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00027}00027\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00031}00031\ \textcolor{keywordtype}{void}\ mapearBytesParaCodigos(node\_t\ *tree\_node,\ BitHuff\ table[],\ BitHuff\ codigo\_parafolha)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00032}00032\ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00033}00033\ \ \ \ \ \textcolor{comment}{//\ Verifica\ se\ o\ nó\ atual\ é\ uma\ folha\ da\ árvore}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00034}00034\ \ \ \ \ \textcolor{comment}{//\ Uma\ folha\ representa\ um\ caractere\ que\ será\ codificado}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00035}00035\ \ \ \ \ \textcolor{keywordflow}{if}\ (tree\_node-\/>left\ ==\ NULL\ \&\&\ tree\_node-\/>right\ ==\ NULL)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00036}00036\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00038}00038\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ O\ nó\ é\ uma\ folha,\ então\ armazenamos\ o\ código\ acumulado\ na\ tabela}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00039}00039\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00040}00040\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ getByteFromVoidPointer(tree\_node-\/>byte)\ converte\ o\ byte\ do\ nó\ para\ um\ índice}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00041}00041\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00042}00042\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ table\ é\ um\ array\ que\ mapeia\ cada\ byte\ para\ seu\ respectivo\ código\ Huffman}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00043}00043\ \ \ \ \ \ \ \ \ table[recuperarByteDePonteiroVoid(tree\_node)]\ =\ codigo\_parafolha;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00044}00044\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00045}00045\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};\ \textcolor{comment}{//\ n\ tem\ mais\ nodes\ entao\ retorna}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00046}00046\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00047}00047\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00048}00048\ \ \ \ \ \textcolor{comment}{//\ Aumenta\ o\ tamanho\ do\ código\ acumulado\ para\ o\ próximo\ nível\ da\ árvore}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00049}00049\ \ \ \ \ \textcolor{comment}{//\ Isso\ é\ necessário,\ pois\ cada\ vez\ que\ descemos\ um\ nível\ na\ árvore,\ o\ código\ se\ torna\ um\ bit\ maior}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00050}00050\ \ \ \ \ codigo\_parafolha.size++;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00051}00051\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00052}00052\ \ \ \ \ \textcolor{comment}{//\ switch\ para\ controlar\ o\ fluxo\ da\ navegação\ na\ árvore}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00053}00053\ \ \ \ \ \textcolor{keywordflow}{switch}\ (1)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00054}00054\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00055}00055\ \ \ \ \ \textcolor{comment}{//\ Caso\ 1:\ Processa\ o\ filho\ esquerdo\ do\ nó\ atual}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00056}00056\ \ \ \ \ \textcolor{keywordflow}{case}\ 1:}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00057}00057\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verifica\ se\ o\ nó\ esquerdo\ não\ é\ nulo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00058}00058\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tree\_node-\/>left\ !=\ NULL)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00059}00059\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00060}00060\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cria\ uma\ cópia\ do\ código\ acumulado\ para\ a\ chamada\ recursiva\ do\ filho\ esquerdo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00061}00061\ \ \ \ \ \ \ \ \ \ \ \ \ BitHuff\ leftCode\ =\ codigo\_parafolha;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00062}00062\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Desloca\ o\ código\ para\ a\ esquerda\ (multiplicação\ por\ 2\ em\ binário)}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00063}00063\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Isso\ adiciona\ um\ 0\ ao\ final\ do\ código,\ representando\ a\ escolha\ do\ caminho\ esquerdo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00064}00064\ \ \ \ \ \ \ \ \ \ \ \ \ leftCode.bitH\ <<=\ 1;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00065}00065\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Chama\ recursivamente\ a\ função\ para\ processar\ o\ nó\ esquerdo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00066}00066\ \ \ \ \ \ \ \ \ \ \ \ \ mapearBytesParaCodigos(tree\_node-\/>left,\ table,\ leftCode);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00067}00067\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00068}00068\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Não\ break\ aqui\ permite\ continuar\ para\ o\ próximo\ caso}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00070}00070\ \ \ \ \ \textcolor{comment}{//\ Caso\ 2:\ Processa\ o\ filho\ direito\ do\ nó\ atual}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00071}00071\ \ \ \ \ \textcolor{keywordflow}{case}\ 2:}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00072}00072\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Verifica\ se\ o\ nó\ direito\ não\ é\ nulo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00073}00073\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tree\_node-\/>right\ !=\ NULL)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00074}00074\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00075}00075\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Cria\ uma\ cópia\ do\ código\ acumulado\ para\ a\ chamada\ recursiva\ do\ filho\ direito}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00076}00076\ \ \ \ \ \ \ \ \ \ \ \ \ BitHuff\ rightCode\ =\ codigo\_parafolha;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00077}00077\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Desloca\ o\ código\ para\ a\ esquerda\ e\ adiciona\ um\ 1\ ao\ final\ do\ código}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00078}00078\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Isso\ representa\ a\ escolha\ do\ caminho\ direito}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00079}00079\ \ \ \ \ \ \ \ \ \ \ \ \ rightCode.bitH\ =\ (rightCode.bitH\ <<\ 1)\ |\ 1;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00080}00080\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Chama\ recursivamente\ a\ função\ para\ processar\ o\ nó\ direito}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00081}00081\ \ \ \ \ \ \ \ \ \ \ \ \ mapearBytesParaCodigos(tree\_node-\/>right,\ table,\ rightCode);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00082}00082\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00083}00083\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{break};\ \textcolor{comment}{//\ Finaliza\ o\ switch}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00084}00084\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00085}00085\ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00088}00088\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00089}00089\ \textcolor{keywordtype}{int}\ tamanho\_lixo(\textcolor{keywordtype}{int}\ frequency[],\ BitHuff\ table[])}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00090}00090\ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00091}00091\ \ \ \ \ \textcolor{keywordtype}{long}\ bits\_antes\ =\ 0;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00092}00092\ \ \ \ \ \textcolor{keywordtype}{long}\ bits\_depois\ =\ 0;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00093}00093\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00094}00094\ \ \ \ \ \textcolor{keywordtype}{int}\ i\ =\ 0;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00095}00095\ \ \ \ \ \textcolor{keywordflow}{while}\ (i\ <\ 256)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00096}00096\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00097}00097\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (frequency[i]\ !=\ 0)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00098}00098\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00099}00099\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bits\_antes\ é\ a\ quantidade\ de\ bits\ original\ (sem\ compressao)}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00100}00100\ \ \ \ \ \ \ \ \ \ \ \ \ bits\_antes\ +=\ frequency[i]\ *\ 8;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00101}00101\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ multiplicado\ por\ 8\ pq\ i\ eh\ armazenado\ em\ um\ byte\ antes\ da\ compressao}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00102}00102\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00103}00103\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ bits\_depois\ é\ a\ quantidade\ total\ de\ bits\ após\ a\ compressão}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00104}00104\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Usa\ o\ tamanho\ do\ código\ em\ huff\ armazenado\ em\ table[i].size}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00105}00105\ \ \ \ \ \ \ \ \ \ \ \ \ bits\_depois\ +=\ frequency[i]\ *\ table[i].size;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00106}00106\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00107}00107\ \ \ \ \ \ \ \ \ i++;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00108}00108\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00109}00109\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00110}00110\ \ \ \ \ \textcolor{comment}{//\ Calcula\ o\ "{}lixo"{}\ (bits\ não\ usados\ no\ último\ byte)}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00111}00111\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00112}00112\ \ \ \ \ \textcolor{comment}{//\ diferença\ entre\ bits\_antes\ e\ bits\_depois\ indica\ quantos\ bits\ foram\ "{}perdidos"{}\ ou\ não\ utilizados.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00113}00113\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00114}00114\ \ \ \ \ \textcolor{keywordtype}{int}\ trash\ =\ (bits\_antes\ -\/\ bits\_depois)\ \%\ 8;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00115}00115\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00116}00116\ \ \ \ \ \textcolor{keywordflow}{return}\ trash;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00117}00117\ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00118}00118\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00119}00119\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00120}00120\ \textcolor{comment}{\ \ \ \ Função\ que\ \ cria\ e\ escreve\ os\ dos\ dois\ primeiros\ bytes}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00121}00121\ \textcolor{comment}{\ \ \ \ que\ armazenam\ o\ tamanho\ do\ lixo\ e\ da\ árvore.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00122}00122\ \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00123}00123\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00124}00124\ \textcolor{keywordtype}{void}\ escrever\_no\_Cabecalho\_Arquivo\_compac(FILE\ *file,\ \textcolor{keywordtype}{int}\ trashSize,\ \textcolor{keywordtype}{int}\ treeSize)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00125}00125\ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00126}00126\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ primeiro\_byte\ =\ 0x00;\ \textcolor{comment}{//\ Inicializa\ o\ primeiro\ byte\ com\ 0}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00127}00127\ \ \ \ \ \textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}\ segundo\_byte\ =\ 0x00;\ \ \textcolor{comment}{//\ Inicializa\ o\ segundo\ byte\ com\ 0}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00128}00128\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00129}00129\ \ \ \ \ \textcolor{comment}{//\ Primeiro\ byte:}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00130}00130\ \ \ \ \ \textcolor{comment}{//\ -\/\ Pega\ os\ 3\ bits\ mais\ significativos\ do\ tamanho\ do\ lixo\ (trashSize)}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00131}00131\ \ \ \ \ \textcolor{comment}{//\ -\/\ Usa\ o\ operador\ <<\ para\ deslocar\ o\ trashSize\ 5\ bits\ para\ a\ esquerda,\ colocando-\/o\ nos\ 3\ bits\ mais\ significativos\ do\ byte.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00132}00132\ \ \ \ \ primeiro\_byte\ =\ primeiro\_byte\ |\ (trashSize\ <<\ 5);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00133}00133\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00134}00134\ \ \ \ \ \textcolor{comment}{//\ -\/\ Agora,\ pega\ os\ 5\ bits\ mais\ significativos\ do\ tamanho\ da\ árvore\ (treeSize)}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00135}00135\ \ \ \ \ \textcolor{comment}{//\ -\/\ Usa\ o\ operador\ >>\ para\ deslocar\ 8\ bits\ para\ a\ direita,\ movendo\ os\ 5\ bits\ mais\ significativos\ para\ o\ lugar\ correto.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00136}00136\ \ \ \ \ primeiro\_byte\ =\ primeiro\_byte\ |\ (treeSize\ >>\ 8);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00137}00137\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00138}00138\ \ \ \ \ \textcolor{comment}{//\ Segundo\ byte:}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00139}00139\ \ \ \ \ \textcolor{comment}{//\ -\/\ Aqui\ colocamos\ os\ 8\ bits\ menos\ significativos\ do\ tamanho\ da\ árvore}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00140}00140\ \ \ \ \ \textcolor{comment}{//\ -\/\ Como\ os\ 8\ bits\ menos\ significativos\ já\ estão\ no\ lugar\ certo,\ basta\ fazer\ uma\ operação\ OR\ simples.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00141}00141\ \ \ \ \ segundo\_byte\ =\ segundo\_byte\ |\ treeSize;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00142}00142\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00143}00143\ \ \ \ \ \textcolor{comment}{//\ Escreve\ os\ dois\ bytes\ no\ arquivo}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00144}00144\ \ \ \ \ fwrite(\&primeiro\_byte,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}),\ 1,\ file);\ \textcolor{comment}{//\ Escreve\ o\ primeiro\ byte}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00145}00145\ \ \ \ \ fwrite(\&segundo\_byte,\ \textcolor{keyword}{sizeof}(\textcolor{keywordtype}{unsigned}\ \textcolor{keywordtype}{char}),\ 1,\ file);\ \ \textcolor{comment}{//\ Escreve\ o\ segundo\ byte}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00146}00146\ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00147}00147\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00148}00148\ \textcolor{comment}{/*}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00149}00149\ \textcolor{comment}{\ \ \ \ setar\ a\ árvore\ no\ arquivo\ compactado}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00150}00150\ \textcolor{comment}{*/}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00153}00153\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00154}00154\ \textcolor{comment}{//\ escrever\ a\ estrutura\ da\ árvore\ de\ Huffman\ no\ arquivo\ compactado}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00155}00155\ \textcolor{comment}{//\ oque\ garante\ ser\ reconstruída\ durante\ a\ descompressão.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00156}00156\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00157}00157\ \textcolor{keywordtype}{void}\ escrever\_arvore(FILE\ *file,\ node\_t\ *arvore\_b)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00158}00158\ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00159}00159\ \ \ \ \ \textcolor{keywordflow}{if}\ (arvore\_b\ ==\ NULL)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00160}00160\ \ \ \ \ \{\ \textcolor{comment}{//\ se\ arvore\ for\ nula}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00161}00161\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00162}00162\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00163}00163\ \ \ \ \ \textcolor{keywordflow}{if}\ (arvore\_b-\/>left\ ==\ NULL\ \&\&\ arvore\_b-\/>right\ ==\ NULL\ \&\&\ (arvore\_b-\/>byte\ ==\ \textcolor{charliteral}{'*'}\ ||\ arvore\_b-\/>byte\ ==\ \textcolor{charliteral}{'\(\backslash\)\(\backslash\)'}))}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00164}00164\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00165}00165\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00166}00166\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ uint8\_t\ representa\ um\ inteiro\ sem\ sinal\ de\ 8\ bits}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00167}00167\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00168}00168\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ criar\ um\ escape}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00169}00169\ \ \ \ \ \ \ \ \ uint8\_t\ scape\ =\ (uint8\_t)\textcolor{charliteral}{'\(\backslash\)\(\backslash\)'};}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00170}00170\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00171}00171\ \ \ \ \ \ \ \ \ fwrite(\&scape,\ \textcolor{keyword}{sizeof}(uint8\_t),\ 1,\ file);\ \textcolor{comment}{//\ file\ =\ arquivo\_comprimido}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00172}00172\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00173}00173\ \ \ \ \ uint8\_t\ \textcolor{keywordtype}{byte}\ =\ arvore\_b-\/>byte;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00174}00174\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00175}00175\ \ \ \ \ fwrite(\&\textcolor{keywordtype}{byte},\ \textcolor{keyword}{sizeof}(uint8\_t),\ 1,\ file);\ \textcolor{comment}{//\ escreve\ em\ um\ arquivo\ comprimido}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00176}00176\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00177}00177\ \ \ \ \ \textcolor{comment}{//\ chama\ da\ raiz\ para\ os\ dois\ nos\ a\ direita\ e\ esqueda}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00178}00178\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00179}00179\ \ \ \ \ \textcolor{comment}{//\ funcoes\ escrrever\_arvore\_no\_cabecalho}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00180}00180\ \ \ \ \ \textcolor{comment}{//\ chamadas\ recursivamentes\ com\ o\ arquivo\ e\ arvore\ esquerda/direita}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00181}00181\ \ \ \ \ \textcolor{comment}{//\ como\ argumentto}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00182}00182\ \ \ \ \ escrever\_arvore(file,\ arvore\_b-\/>left);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00183}00183\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00184}00184\ \ \ \ \ \textcolor{comment}{//\ quando\ for\ null}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00185}00185\ \ \ \ \ \textcolor{comment}{//\ vai\ a\ direita}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00186}00186\ \ \ \ \ escrever\_arvore(file,\ arvore\_b-\/>right);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00187}00187\ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00188}00188\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00191}00191\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00192}00192\ \textcolor{comment}{//\ Essa\ função\ lê\ o\ arquivo\ de\ entrada\ fileIn\ byte\ por\ byte,}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00193}00193\ \textcolor{comment}{//\ converte\ cada\ byte\ em\ seu\ código\ correspondente\ de\ Huffman\ (usando\ a\ tabela\ BitHuff)}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00194}00194\ \textcolor{comment}{//\ \ e\ grava\ esses\ códigos\ compactados\ no\ arquivo\ de\ saída\ fileOut}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00195}00195\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00196}00196\ \textcolor{keywordtype}{void}\ gravarCodigos(FILE\ *fileIn,\ FILE\ *fileOut,\ BitHuff\ table[],\ \textcolor{keywordtype}{int}\ trashSize)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00197}00197\ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00198}00198\ \ \ \ \ uint8\_t\ acumulador\_bits\ =\ 0;\ \textcolor{comment}{//\ Acumulador\ para\ armazenar\ os\ bits\ temporários\ (8\ bits),\ que\ serão\ escritos\ no\ arquivo\ de\ saída.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00199}00199\ \ \ \ \ \textcolor{keywordtype}{int}\ tamanho\_acumulador\ =\ 0;\ \ \textcolor{comment}{//\ Contador\ para\ a\ quantidade\ de\ bits\ armazenados\ no\ acumulador,\ para\ saber\ quando\ ele\ está\ "{}cheio"{}.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00200}00200\ \ \ \ \ \textcolor{keywordtype}{int}\ caractere;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Variável\ para\ armazenar\ temporariamente\ cada\ caractere\ lido\ do\ arquivo\ de\ entrada.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00201}00201\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00202}00202\ \ \ \ \ \textcolor{comment}{//\ Lê\ o\ arquivo\ de\ entrada\ byte\ por\ byte}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00203}00203\ \ \ \ \ \textcolor{comment}{//\ A\ função\ 'getc'\ lê\ um\ caractere\ (byte)\ por\ vez\ do\ arquivo\ 'fileIn'.\ A\ leitura\ continua\ até\ atingir\ o\ final\ do\ arquivo\ (EOF).}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00204}00204\ \ \ \ \ \textcolor{keywordflow}{while}\ ((caractere\ =\ getc(fileIn))\ !=\ EOF)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00205}00205\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00206}00206\ \ \ \ \ \ \ \ \ BitHuff\ entry\ =\ table[caractere];\ \textcolor{comment}{//\ A\ tabela\ de\ Huffman\ ('table')\ contém\ o\ código\ binário\ (compressão)\ para\ cada\ caractere.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00207}00207\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00208}00208\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Aqui,\ 'entry'\ armazena\ o\ código\ binário\ e\ seu\ tamanho\ (em\ bits)\ correspondente\ ao\ caractere\ lido.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00209}00209\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00210}00210\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Percorre\ cada\ bit\ do\ código\ de\ Huffman\ correspondente\ ao\ caractere\ atual}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00211}00211\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Esse\ loop\ percorre\ o\ código\ de\ Huffman\ do\ último\ bit\ até\ o\ primeiro\ (do\ bit\ mais\ significativo\ ao\ menos\ significativo).}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00212}00212\ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{for}\ (\textcolor{keywordtype}{int}\ i\ =\ entry.size\ -\/\ 1;\ i\ >=\ 0;\ -\/-\/i)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00213}00213\ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00214}00214\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Inserir\ o\ próximo\ bit\ no\ acumulador}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00215}00215\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ A\ operação\ 'acumulador\_bits\ <<\ 1'\ desloca\ os\ bits\ do\ acumulador\ uma\ posição\ para\ a\ esquerda,\ abrindo\ espaço\ para\ o\ novo\ bit.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00216}00216\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ '((entry.bitH\ >>\ i)\ \&\ 1)'\ extrai\ o\ i-\/ésimo\ bit\ do\ código\ Huffman\ (1\ ou\ 0)\ e\ o\ adiciona\ no\ acumulador.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00217}00217\ \ \ \ \ \ \ \ \ \ \ \ \ acumulador\_bits\ =\ (acumulador\_bits\ <<\ 1)\ |\ ((entry.bitH\ >>\ i)\ \&\ 1);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00218}00218\ \ \ \ \ \ \ \ \ \ \ \ \ tamanho\_acumulador++;\ \textcolor{comment}{//\ Incrementa\ o\ contador,\ indicando\ que\ mais\ um\ bit\ foi\ adicionado\ ao\ acumulador.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00219}00219\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00220}00220\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Quando\ o\ acumulador\ estiver\ cheio\ (8\ bits\ completos),\ ele\ deve\ ser\ escrito\ no\ arquivo\ de\ saída.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00221}00221\ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{keywordflow}{if}\ (tamanho\_acumulador\ ==\ 8)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00222}00222\ \ \ \ \ \ \ \ \ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00223}00223\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ fwrite(\&acumulador\_bits,\ \textcolor{keyword}{sizeof}(uint8\_t),\ 1,\ fileOut);\ \textcolor{comment}{//\ Escreve\ 1\ byte\ (8\ bits)\ no\ arquivo\ de\ saída\ 'fileOut'.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00224}00224\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ acumulador\_bits\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reseta\ o\ acumulador\ para\ que\ ele\ possa\ armazenar\ novos\ bits.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00225}00225\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ tamanho\_acumulador\ =\ 0;\ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Reinicia\ o\ contador\ para\ os\ próximos\ bits\ a\ serem\ acumulados.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00226}00226\ \ \ \ \ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00227}00227\ \ \ \ \ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00228}00228\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00229}00229\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00230}00230\ \ \ \ \ \textcolor{comment}{//\ Após\ ler\ todos\ os\ bytes\ do\ arquivo\ de\ entrada,\ pode\ haver\ bits\ restantes\ no\ acumulador\ que\ não\ foram\ escritos\ ainda.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00231}00231\ \ \ \ \ \textcolor{comment}{//\ Isso\ acontece\ quando\ o\ arquivo\ termina\ mas\ o\ acumulador\ não\ chegou\ a\ 8\ bits\ completos.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00232}00232\ \ \ \ \ \textcolor{keywordflow}{if}\ (tamanho\_acumulador\ >\ 0)}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00233}00233\ \ \ \ \ \{}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00234}00234\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Adiciona\ o\ "{}lixo"{}\ (bits\ extras\ que\ não\ fazem\ parte\ dos\ dados)\ ao\ final\ do\ último\ byte.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00235}00235\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ O\ 'trashSize'\ indica\ quantos\ desses\ bits\ finais\ são\ irrelevantes\ para\ a\ informação,\ necessários\ para\ completar\ o\ último\ byte.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00236}00236\ \ \ \ \ \ \ \ \ acumulador\_bits\ <<=\ trashSize;}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00237}00237\ }
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00238}00238\ \ \ \ \ \ \ \ \ \textcolor{comment}{//\ Escreve\ o\ último\ byte\ (com\ os\ bits\ restantes\ e\ os\ bits\ de\ "{}lixo"{})\ no\ arquivo\ de\ saída.}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00239}00239\ \ \ \ \ \ \ \ \ fwrite(\&acumulador\_bits,\ \textcolor{keyword}{sizeof}(uint8\_t),\ 1,\ fileOut);}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00240}00240\ \ \ \ \ \}}
\DoxyCodeLine{\Hypertarget{compressao_8c_source_l00241}00241\ \}}

\end{DoxyCode}
